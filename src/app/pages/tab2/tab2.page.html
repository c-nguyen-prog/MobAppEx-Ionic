<!-- <ion-header>

    <ion-toolbar>
        <ion-item lines="none">
            <ion-searchbar (ionChange)="onSearchChange($event)" class="search-bar" [(ngModel)]="searchTerm" #searchbar></ion-searchbar>
            <ion-icon class="grid" name="apps" slot="end"></ion-icon>
        </ion-item>
        <ion-segment (ionChange)="onSegmentChange($event)" #segment>
            <ion-segment-button value="0" checked #button0>
                <ion-label>Map</ion-label>
            </ion-segment-button>
            <ion-segment-button value="1" #button1>
                <ion-label>List</ion-label>
            </ion-segment-button>
            <ion-segment-button value="2" #button2>
                <ion-label>Favorites</ion-label>
            </ion-segment-button>
            <ion-segment-button value="3" #button3>
                <ion-label>By Time</ion-label>
            </ion-segment-button>
        </ion-segment>
    </ion-toolbar>
</ion-header>
<ion-content>
    <ion-fab vertical="bottom" horizontal="end" slot="fixed">
        <ion-fab-button (click)="onFabSelect()">
            <ion-icon name="search"></ion-icon>
        </ion-fab-button>
    </ion-fab>

    <ion-slides pager="false" (ionSlideDidChange)="onSlideDidChange($event)" #slides>
        <ion-slide class="slide">
            Map
        </ion-slide>
        <ion-slide class="slide">
            List
        </ion-slide>
        <ion-slide class="slide">
            Fav
        </ion-slide>
        <ion-slide class="slide">
            By
        </ion-slide>

    </ion-slides>
</ion-content> -->

<ion-content>
  <div id="mapdiv" [@animatemapup]="cardTSS_state">
    <agm-map [latitude]="latMapCenter + 0.0003" [longitude]="lngMapCenter" [zoom]="mapZoomLevel" [zoomControl]="false"
      [streetViewControl]="false" [fitBounds]="false" (boundsChange)="onBoundsChanged($event)">
      <agm-marker *ngFor="let item of capsules; let i = index" [latitude]="item.Latitude" [longitude]="item.Longitude"
        [label]="" [iconUrl]="capsuleIcon" (markerClick)="clickedMarker(item.Name, i)">
        <agm-info-window [isOpen]="item.isOpen">
          <strong id="colorWorkaround">{{ item.Name }}</strong>
        </agm-info-window>
      </agm-marker>
      <agm-marker [latitude]="latMapCenter" [longitude]="lngMapCenter" [iconUrl]="personIcon">
      </agm-marker>
    </agm-map>
    <ion-button id="btn_Position" (click)="getPositionClick()">
      <ion-icon name="md-locate" style="color: red" *ngIf="!spinBtnPositionPressed"></ion-icon>
      <ion-spinner name="crescent" style="color: red" *ngIf="spinBtnPositionPressed"></ion-spinner>
    </ion-button>
  </div>
  
  <ion-fab id="fab" horizontal="center" slot="fixed" hidden>
    <ion-fab-button size="small">
      <ion-icon name="arrow-up"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <ion-slides #slider id="slider" [options]="slidesConfig" (ionSlideDidChange)="onSlideChanged()">
    <ion-slide *ngFor="let item of capsules; let i = index">
      <ion-card id="slideCard" class="slideCards" mode="ios" *ngIf="item" (click)="cardClicked(i)">
          <img *ngIf="item.isBooked" src="../../../assets/images/BookedLabel.png" style="height: 60px; width: 60px; z-index: 100; position: absolute; left: 0; top:0;"/>
          <ion-card-title>
            <h4>
              {{ item.Name }}
            </h4>
          </ion-card-title>
          <ion-card-subtitle>
            <h6>
              {{ getDistance(latMapCenter, lngMapCenter, item.Latitude, item.Longitude) }} meters
            </h6>
          </ion-card-subtitle>
          <ion-card-subtitle>
            <h6>
              next slot bla
            </h6>
          </ion-card-subtitle>
          <ion-button shape="round" size="default" expand="block" (click)="animateTSS_Click(item)">book this one
          </ion-button>
      </ion-card>
    </ion-slide>
  </ion-slides>
</ion-content>


<ion-card id="cardTSS_top" [@animatecardtotop]="cardTSS_state" (@animatecardtotop.done)="animatecardtotopDone($event)">
  <ion-card-header>
      <ion-button id="btn-calendar" fill="clear" style="position: absolute; top:0; right:0; z-index:100;" (click)="animateTSS_Click()">
          <ion-icon id="ico_calendar" name="close" ></ion-icon>
      </ion-button>
    <ion-card-title>
      <h4>
          {{capName}}
      </h4>
    </ion-card-title>
    <ion-card-subtitle>
      blabla
    </ion-card-subtitle>
  </ion-card-header>
  <ion-card-content>

  </ion-card-content>
 
</ion-card>


<ion-content id="root" style="visibility: hidden">

  <ion-card id="headr" mode="md" style="visibility:collapse">
    <ion-card-header>
      <h4></h4>
    </ion-card-header>
  </ion-card>

  <ion-card id="listr">
    <ion-content id="testre" #content scrollX="true" scrollY="false">
      <ion-segment id="segmt" #segment mode="md" >
        <ion-segment-button *ngFor="let day of days; let i = index" [value]="i" checked (click)="onSegmentClick(day)">
          {{day.date}}
        </ion-segment-button>
      </ion-segment>
    </ion-content>
    <input #matInput [matDatepicker]="picker" [min]="minDate" [max]="maxDate" (dateChange)="onDatePickerChanged(matInput.value)" style="visibility: collapse; right:0; position: absolute; z-index: -100; top: 0;">
      <mat-datepicker #picker></mat-datepicker>
    <ion-button id="btn-calendar" fill="clear" (click)="picker.open()">
      <ion-icon id="ico_calendar" name="calendar"></ion-icon>
    </ion-button>

    <ion-content>
      <ion-slides id="slides" #slides [options]="slideOpts" style="height: 100%;" (ionSlideDidChange)="onIonSlideDidChange($event)"
        (ionSlidePrevStart)="onIonSlidePrevStart()" (ionSlidePrevEnd)="onIonSlidePrevEnd()"
        (ionSlideNextStart)="onIonSlideNextStart()" (ionSlideNextEnd)="onIonSlideNextEnd()"
        (ionSlideTouchStart)="onIonSlideTouchStart()" *ngIf="timeslots && timeslots.length">
        <ion-slide>
          <ion-content id="hallo" #tscontent>
        
              <ion-icon class="odd" name=""></ion-icon>

                <div class="blocker collapsed"></div>
              <div class="blocker-line collapsed"></div>
            <div class="blocker-time collapsed" >{{currentTime}}</div>

            

            <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
              <ion-refresher-content pullingIcon="arrow-dropdown" pullingText="Pull to refresh"
                refreshingSpinner="crescent" refreshingText="Refreshing...">
              </ion-refresher-content>
            </ion-refresher>

            <ion-list class="odd2" lines="full">
              <div *ngFor="let item of timeslots; let i = index" >
                <ion-item class="tsitem" button="true" *ngIf="item.state == true" (click)="onTimeSlotClick(i)">
                  <div slot="start">{{ item.content }}</div>
                  <div slot="end">FREE</div>
                </ion-item>
                <ion-item class="tsitem" button="true" *ngIf="item.state == false"
                  style="--background: rgba(255, 0, 0, 0.2); color: rgb(224, 0, 0);">
                  <div slot="start">{{ item.content }}</div>
                  <div slot="end">TAKEN</div>
                </ion-item>
                <ion-item class="tsitem" button="true" *ngIf="item.state == 'selected'"
                  style="--background: rgba(0, 206, 0, 0.2); color: rgb(0, 170, 0);"  (click)="onTimeSlotClick(i)">
                  <div slot="start">{{ item.content }}</div>
                  <div slot="end">SELECTED</div>
                </ion-item>
                <ion-item class="tsitem" class="tsitem" button="true" *ngIf="item.state == 'booked'"
                  style="--background: rgba(0, 217, 255, 0.2); color: rgb(0, 161, 201);">
                  <div slot="start">{{ item.content }}</div>
                  <div slot="end">YOURS</div>
                </ion-item>
                <ion-item class="tsitem" button="true" *ngIf="item.state == 'blocked'"
                  style="--background: rgba(190, 190, 190, 0.2); color: rgb(180, 180, 180); opacity: .5;">
                  <div slot="start">{{ item.content }}</div>
                  <div slot="end">FREE</div>
                </ion-item>
                <ion-item class="tsitem" button="true" *ngIf="item.state == 'impossible'"
                style="--background: rgba(190, 190, 190, 0.2); color: rgb(180, 180, 180); opacity: .5;">
                <div slot="start">{{ item.content }}</div>
                <div slot="end">FREE</div>
              </ion-item>
                <!-- <ion-item class="tsitem" button="true" *ngIf="item.state == 'blocked'"
                  style="opacity: .25;">
                  <div slot="start">{{ item.content }}</div>
                  <div slot="end">FREE</div>
                </ion-item> -->
                <ion-item class="tsitem" button="true" *ngIf="item.state == 'inprogress'"
                  style="--background: rgba(255, 123, 0, 0.2); color: rgb(255, 123, 0);">
                  <div slot="start">{{ item.content }}</div>
                  <div slot="end">IN SELECTION...</div>
                </ion-item>
              </div>
            </ion-list>
          </ion-content>
        </ion-slide>
        <ion-slide>
          <ion-content>
            
              <ion-icon class="even" name=""></ion-icon>
           

            <!-- <ion-refresher  slot="fixed" (ionRefresh)="doRefresh($event)">
              <ion-refresher-content pullingIcon="arrow-dropdown" pullingText="Pull to refresh"
                refreshingSpinner="crescent" refreshingText="Refreshing...">
              </ion-refresher-content>
            </ion-refresher> -->

            <ion-list class="even2" lines="full">
                <div *ngFor="let item of timeslots; let i = index">
                  <ion-item button="true" *ngIf="item.state == true" (click)="onTimeSlotClick(i)">
                    <div slot="start">{{ item.content }}</div>
                    <div slot="end">FREE</div>
                  </ion-item>
                  <ion-item button="true" *ngIf="item.state == false"
                    style="--background: rgba(255, 0, 0, 0.2); color: rgb(224, 0, 0);">
                    <div slot="start">{{ item.content }}</div>
                    <div slot="end">TAKEN</div>
                  </ion-item>
                  <ion-item button="true" *ngIf="item.state == 'selected'"
                    style="--background: rgba(0, 206, 0, 0.2); color: rgb(0, 170, 0);"  (click)="onTimeSlotClick(i)">
                    <div slot="start">{{ item.content }}</div>
                    <div slot="end">SELECTED</div>
                  </ion-item>
                  <ion-item button="true" *ngIf="item.state == 'booked'"
                    style="--background: rgba(0, 217, 255, 0.2); color: rgb(0, 161, 201);">
                    <div slot="start">{{ item.content }}</div>
                    <div slot="end">YOURS</div>
                  </ion-item>
                  <ion-item button="true" *ngIf="item.state == 'blocked'"
                    style="--background: rgba(190, 190, 190, 0.2); color: rgb(180, 180, 180);">
                    <div slot="start">{{ item.content }}</div>
                    <div slot="end">FREE</div>
                  </ion-item>
                  <ion-item button="true" *ngIf="item.state == 'inprogress'"
                    style="--background: rgba(255, 123, 0, 0.2); color: rgb(255, 123, 0);">
                    <div slot="start">{{ item.content }}</div>
                    <div slot="end">IN SELECTION...</div>
                  </ion-item>
                </div>
              </ion-list>
          </ion-content>
        </ion-slide>
      </ion-slides>
    </ion-content>
  </ion-card>

  <ion-card id="footr">
    <ion-item id="summary" lines="none">
      <div slot="start">{{selectedCount}} slots ({{selectedCount*20}}min)</div>
      <div slot="end">{{selectedCount * PRICE_PER_SLOT}}.00 €</div>
    </ion-item>
    <ion-button id="btn_checkout" size="small" expand="block" shape="round" padding (click)="proceedToCheckoutClick()" [disabled]="!canProceedCheckout()">
      Proceed To Checkout
    </ion-button>
  </ion-card>
</ion-content>